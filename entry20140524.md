InnoDBのオプティマイザとロックの範囲の関係
================================================

MySQLのInnoDBのロックの挙動を色々調べていたのですが、
レコードの数によってロックの範囲が変わる現象に頭を悩まされたので
メモがてら少しまとめてみます。

どこまでロックする？
-------------------

以下のようなテーブル`t`があるとします。
id列しかないシンプルなテーブルです。

```mysql
CREATE TABLE t (
    `id` int unsinged NOT NULL,
    PRIMARY KEY (`id`)
)ENGINE InnoDB;

INSERT INTO (
```

idカラムのみ存在するtテーブルに(1, 2, 3, 5)というレコードが入っていた時、

`SELECT * FROM t WHERE id < 3 LOCK IN SHARE MODE;`

というクエリを投げるとどのレコードまでロックするでしょうか。

オプティマイザの選択によります。


結局はInnoDBがどこまでレコードを読んだかが決め手になります。
